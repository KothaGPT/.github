name: Labeler

on:
  issues:
    types: [opened, edited]
  pull_request_target:
    types: [opened, edited]

permissions:
  contents: read
  issues: write
  pull-requests: write

jobs:
  label:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      - name: Apply AI-specific labels based on content
        uses: actions/github-script@v8
        with:
          script: |
            const body = context.payload.issue?.body || context.payload.pull_request?.body || '';
            const title = context.payload.issue?.title || context.payload.pull_request?.title || '';

            const aiKeywords = ['model', 'training', 'inference', 'neural network', 'transformer', 'pytorch', 'tensorflow', 'huggingface'];
            const hasAIKeywords = aiKeywords.some(keyword =>
              body.toLowerCase().includes(keyword) || title.toLowerCase().includes(keyword)
            );

            if (hasAIKeywords) {
              github.rest.issues.addLabels({
                issue_number: context.issue.number,
                owner: context.repo.owner,
                repo: context.repo.repo,
                labels: ['ai:model']
              });
            }

            const performanceKeywords = ['slow', 'performance', 'optimization', 'memory', 'cpu', 'gpu'];
            const hasPerformanceKeywords = performanceKeywords.some(keyword =>
              body.toLowerCase().includes(keyword) || title.toLowerCase().includes(keyword)
            );

            if (hasPerformanceKeywords) {
              github.rest.issues.addLabels({
                issue_number: context.issue.number,
                owner: context.repo.owner,
                repo: context.repo.repo,
                labels: ['type: performance']
              });
            }

            const bugKeywords = ['bug', 'error', 'fix', 'issue', 'problem'];
            const hasBugKeywords = bugKeywords.some(keyword =>
              body.toLowerCase().includes(keyword) || title.toLowerCase().includes(keyword)
            );

            if (hasBugKeywords) {
              github.rest.issues.addLabels({
                issue_number: context.issue.number,
                owner: context.repo.owner,
                repo: context.repo.repo,
                labels: ['type: bug']
              });
            }
